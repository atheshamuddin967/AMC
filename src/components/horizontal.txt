import React, { useEffect, useRef } from "react";
import {
  MapPin,
  Lightbulb,
  Settings,
  Award,
  Users,
  Hammer,
  Building2,
  Shield,
  Zap,
  Clock,
} from "lucide-react";
import gsap from "gsap";
import { ScrollTrigger } from "gsap/ScrollTrigger";

gsap.registerPlugin(ScrollTrigger);

export const ProcessTimeline = () => {
  const sectionRef = useRef<HTMLDivElement>(null);
  const stepsRef = useRef<HTMLDivElement[]>([]);

  useEffect(() => {
    const ctx = gsap.context(() => {
      gsap.from(stepsRef.current, {
        y: 60,
        opacity: 0,
        duration: 0.8,
        stagger: 0.2,
        ease: "power3.out",
        scrollTrigger: {
          trigger: sectionRef.current,
          start: "top 80%",
        },
      });
    }, sectionRef);

    return () => ctx.revert();
  }, []);

  const addToRefs = (el: HTMLDivElement) => {
    if (el && !stepsRef.current.includes(el)) stepsRef.current.push(el);
  };

  const steps = [
    {
      title: "Research",
      icon: <MapPin size={28} />,
      content:
        "Before starting any financial or commercial project, we conduct in-depth research to identify the best features and design elements. Our discovery process ensures every project aligns with the latest design trends and client needs.",
    },
    {
      title: "Feasibility Study",
      icon: <Award size={28} />,
      content:
        "We assess the viability of proposed branch locations to ensure they bring optimal results and sustainable growth for our clients.",
    },
    {
      title: "Planning",
      icon: <Settings size={28} />,
      content:
        "Our strategic planning and site selection expertise helps financial institutions choose the best locations, while we provide purchase and planning assistance.",
    },
    {
      title: "Design",
      icon: <Lightbulb size={28} />,
      content:
        "We merge modern aesthetics with functional efficiency. Our designs focus on customer experience, visibility, and operational flow — inside and out.",
    },
    {
      title: "Bidding",
      icon: <Users size={28} />,
      content:
        "We leverage our experience in negotiating bids to secure the most competitive rates while utilizing trusted local professionals and resources.",
    },
    {
      title: "Architecture",
      icon: <Building2 size={28} />,
      content:
        "We work closely with architects to translate your ideas into detailed, functional plans that meet every technical and visual requirement.",
    },
    {
      title: "Execution",
      icon: <Hammer size={28} />,
      content:
        "Our experienced construction partners ensure top quality. We supervise every stage, maintaining deadlines and delivering your project on time.",
    },
    {
      title: "Interior",
      icon: <Shield size={28} />,
      content:
        "Our interior designers create welcoming, professional spaces that balance comfort and functionality to reflect your brand identity.",
    },
    {
      title: "Post-Launch",
      icon: <Clock size={28} />,
      content:
        "We provide marketing and promotional support post-launch, helping you boost brand recognition and customer engagement.",
    },
  ];

  return (
    <section
      ref={sectionRef}
      className="relative bg-gradient-to-b from-white to-gray-50 py-20 px-6 overflow-hidden"
    >
      <div className="max-w-7xl mx-auto text-center mb-16">
        <h2 className="text-4xl md:text-5xl font-extrabold text-gray-900">
          Our Process
        </h2>
        <p className="text-lg text-gray-600 mt-3">
          From concept to completion — excellence in every step.
        </p>
        <div className="w-20 h-1 bg-gradient-to-r from-blue-500 to-purple-500 mx-auto mt-5 rounded-full"></div>
      </div>

      <div className="relative flex overflow-x-auto scrollbar-thin scrollbar-thumb-blue-400 scrollbar-track-transparent">
        <div className="absolute top-12 left-0 right-0 h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 mx-12 rounded-full hidden md:block"></div>

        <div className="flex gap-10 min-w-max px-10">
          {steps.map((step, i) => (
            <div
              key={i}
              ref={addToRefs}
              className="flex flex-col items-center text-center w-72 shrink-0 relative"
            >
              <div className="relative mb-4">
                <div className="w-16 h-16 flex items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600 text-white shadow-lg shadow-blue-200">
                  {step.icon}
                </div>
                {/* Connector line for desktop */}
                {i < steps.length - 1 && (
                  <span className="hidden md:block absolute top-1/2 right-[-70px] w-14 h-[3px] bg-gradient-to-r from-blue-400 to-purple-500"></span>
                )}
              </div>

              <h3 className="text-xl font-semibold text-gray-900 mb-2">
                {step.title}
              </h3>
              <p className="text-gray-600 text-sm leading-relaxed">
                {step.content}
              </p>
            </div>
          ))}
        </div>
      </div>
    </section>
  );
};
